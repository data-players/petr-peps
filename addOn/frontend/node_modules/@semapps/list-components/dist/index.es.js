import*as e from"react";import t,{useEffect as r,useState as n}from"react";import{useListContext as a,useCreatePath as l,sanitizeListRestProps as i,RecordContextProvider as o,ChipField as c,Link as s,useGetList as u,useResourceDefinition as m,useResourceContext as d,FilterList as f,FilterListItem as p,Button as v,TopToolbar as y,CreateButton as h,ExportButton as g,List as E}from"react-admin";import{LinearProgress as b,Grid as k,Card as w,CardActionArea as x,CardMedia as C,CardContent as L,CardActions as P,useMediaQuery as O}from"@mui/material";import j from"@mui/styles/makeStyles";import N from"@mui/icons-material/AddCircle";import I from"@mui/icons-material/Launch";import{useGetExternalLink as F,useDataModel as S,useContainers as V}from"@semapps/semantic-data-provider";import T from"react-masonry-css";import{useLocation as A}from"react-router";function U(){return(U=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function _(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},l=Object.keys(e);for(n=0;n<l.length;n++)r=l[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(n=0;n<l.length;n++)r=l[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}function R(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==r)return;var n,a,l=[],i=!0,o=!1;try{for(r=r.call(e);!(i=(n=r.next()).done)&&(l.push(n.value),!t||l.length!==t);i=!0);}catch(e){o=!0,a=e}finally{try{i||null==r.return||r.return()}finally{if(o)throw a}}return l}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return W(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return W(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function W(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var B=["classes","className","children","linkType","component","primaryText","appendLink","externalLinks"],D=j((function(){return{root:{display:"flex",flexWrap:"wrap"},link:{textDecoration:"none",maxWidth:"100%"},chipField:{maxWidth:"100%"},addIcon:{cursor:"pointer",fontSize:35,position:"relative",top:2},launchIcon:{width:20,paddingRight:6,marginLeft:-10}}})),z=function(e){return e.stopPropagation()},M=function(){},$=function(e){e.classes,e.className,e.children;var r=e.linkType,n=void 0===r?"edit":r,u=e.component,m=void 0===u?"div":u,d=e.primaryText,f=e.appendLink,p=e.externalLinks,v=void 0!==p&&p,y=_(e,B),h=a(e),g=h.data,E=h.isLoading,k=h.resource,w=F(v),x=l(),C=D(e),L=m;return E?t.createElement(b,null):t.createElement(L,U({className:C.root},i(y)),g.map((function(e){if(!e||e._error)return null;var r=w(e);return r?t.createElement(o,{value:e,key:e.id},t.createElement("a",{href:r,target:"_blank",rel:"noopener noreferrer",className:C.link,onClick:z},t.createElement(c,{source:d,className:C.chipField,color:"secondary",deleteIcon:t.createElement(I,{className:C.launchIcon}),onClick:M,onDelete:M}))):n?t.createElement(o,{value:e,key:e.id},t.createElement(s,{className:C.link,to:x({resource:k,id:e.id,type:n}),onClick:z},t.createElement(c,{source:d,className:C.chipField,color:"secondary",onClick:M}))):t.createElement(o,{value:e,key:e.id},t.createElement(c,{source:d,className:C.chipField,color:"secondary",onClick:M}))})),f&&t.createElement(N,{color:"primary",className:C.addIcon,onClick:f}))},q=function(e){return e.stopPropagation()},G=function(){},H=function(t){var r=t.children,n=t.linkType,i=t.externalLinks,c=t.spacing,u=t.xs,m=t.sm,d=t.md,f=t.lg,p=t.xl,v=a(),y=v.data,h=v.resource,g=v.isLoading,E=F(i),b=l();return g||!y?null:e.createElement(k,{container:!0,spacing:c},y.map((function(t){if(!t||t._error)return null;var a,l=E(t);return a=l?e.createElement("a",{href:l,target:"_blank",rel:"noopener noreferrer",onClick:q},e.cloneElement(e.Children.only(r),{externalLink:!0,onClick:G})):n?e.createElement(s,{to:b({resource:h,id:t.id,type:n}),onClick:q},e.cloneElement(e.Children.only(r),{onClick:G})):r,e.createElement(k,{item:!0,key:t.id,xs:u,sm:m,md:d,lg:f,xl:p},e.createElement(o,{value:t},a))})))};H.defaultProps={xs:6,spacing:3,linkType:"edit",externalLinks:!1};var J=j((function(){return{grid:{display:"flex",marginLeft:-20,marginBottom:-20,width:"auto"},column:{paddingLeft:20,backgroundClip:"padding-box"},card:{marginBottom:20},media:{height:0,paddingTop:"56.25%"}}})),K=function(e){var r=e.image,n=e.content,i=e.actions,c=e.breakpointCols,u=e.linkType,m=J(),d=a(),f=d.data,p=d.resource,v=l();return t.createElement(T,{breakpointCols:c,className:m.grid,columnClassName:m.column},f.map((function(e){if(!e||e._error)return null;var a="function"==typeof r?r(e):r;return t.createElement(o,{value:e},t.createElement(w,{key:e.id,className:m.card},t.createElement(s,{to:v({resource:p,id:e.id,type:u})},t.createElement(x,null,a&&t.createElement(C,{className:m.media,image:a}),n&&t.createElement(L,null,n(e)))),i&&t.createElement(P,null,i.map((function(e){return t.createElement(e)})))))})))};K.defaultProps={breakpointCols:{default:3,1050:2,700:1},linkType:"edit"};var Q=function(e){var r=e.source,n=e.id,a=d(),l=u(a),i=l.data,o=l.isLoading;return t.createElement(t.Fragment,null,"Â ",!o&&t.createElement("span",{className:"filter-count"},"("+Object.values(i).filter((function(e){return[].concat(e[r]).includes(n)})).length+")"))},X=function(e){var n,l=e.reference,i=e.source,o=e.inverseSource,c=e.limit,s=e.sort,v=e.filter,y=e.label,h=e.icon,g=e.showCounters,E=u(l,{page:1,perPage:c},s,v),b=E.data,k=E.isLoading,w=m({resource:l}),x=d();S(x);var C=V(x),L=a();L.displayedFilters,L.filterValues;var P=L.setFilters;L.hideFilter,r((function(){var e=new URLSearchParams(window.location.search);Object.fromEntries(e.entries()).filter||k||P({})}),[]);return t.createElement(f,{label:y||(null==w||null===(n=w.options)||void 0===n?void 0:n.label)||"",icon:h||null!=w&&w.icon?t.createElement(w.icon):void 0},b&&b.filter((function(e){return function(e){if(!o)return!0;if(!C||!e)return!1;var t=!1;return Object.values(C).forEach((function(r){r.forEach((function(r){[].concat(e[o]).forEach((function(e){null!=e&&e.startsWith(r)&&(t=!0)}))}))})),t}(e)})).map((function(e){return t.createElement(p,{key:e.id,label:t.createElement("span",{className:"filter-label"},e["pair:label"],g&&t.createElement(Q,{source:i,id:e.id})),value:(r={},n=i,a=e.id,n in r?Object.defineProperty(r,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):r[n]=a,r)});var r,n,a})))};X.defaultProps={limit:25,showCounters:!0};var Y=t.createContext({views:null,currentView:null,setView:function(){return null}}),Z=function(){var e=new URLSearchParams(A().search),r=t.useContext(Y),n=r.views,a=r.currentView,l=r.setView;return n?Object.entries(n).filter((function(e){return R(e,1)[0]!==a})).map((function(r){var n=R(r,2),a=n[0],i=n[1];return e.set("view",a),e.set("page",1),e.set("perPage",i.perPage),i.sort&&(e.set("sort",i.sort.field),e.set("order",i.sort.order)),t.createElement(s,{key:a,to:"?"+e.toString()},t.createElement(v,{onClick:function(){return l(a)},label:i.label},t.createElement(i.icon)))})):null},ee=["bulkActions","basePath","sort","displayedFilters","exporter","filters","filterValues","onUnselectItems","selectedIds","showFilter","total"],te=function(e){var r=e.bulkActions;e.basePath;var n=e.sort,a=e.displayedFilters,l=e.exporter,i=e.filters,o=e.filterValues,c=e.onUnselectItems,s=e.selectedIds,u=e.showFilter,d=e.total,f=_(e,ee),p=O((function(e){return e.breakpoints.down("sm")})),v=m(f);return t.createElement(y,null,t.createElement(Z,null),i&&t.cloneElement(i,{showFilter:u,displayedFilters:a,filterValues:o,context:"button"}),v.hasCreate&&t.createElement(h,null),!p&&!1!==l&&t.createElement(g,{disabled:0===d,sort:n,filter:o,exporter:l}),r&&t.cloneElement(r,{filterValues:o,selectedIds:s,onUnselectItems:c}))},re=["children","actions","views","ListComponent"],ne=function(e){e.children;var r=e.actions,a=e.views,l=e.ListComponent,i=_(e,re),o=new URLSearchParams(A().search),c=o.has("view")?o.get("view"):Object.keys(a)[0],s=R(n(c),2),u=s[0],m=s[1];return t.createElement(Y.Provider,{value:{views:a,currentView:u,setView:m}},t.createElement(l,U({actions:r,pagination:a[u].pagination,perPage:a[c].perPage,sort:a[c].sort},i),a[u].list))};ne.defaultProps={actions:t.createElement(te,null),ListComponent:E};export{$ as ChipList,H as GridList,te as ListActionsWithViews,Y as ListViewContext,K as MasonryList,ne as MultiViewsList,X as ReferenceFilter,Z as ViewsButtons};
//# sourceMappingURL=index.es.js.map
